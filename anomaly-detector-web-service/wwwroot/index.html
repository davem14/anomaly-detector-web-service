<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="utf-8">
    <title>Anomaly Detection</title>

    <link rel="stylesheet" href="lib/twitter-bootstrap/css/bootstrap.min.css">

    <style>
        .all_page {
            background-repeat: no-repeat;
            background-size: cover;
            background-color: #dddddd;
        }

        .color_title {
            background-color: #1e3947;
        }

        .font_title_style {
            color: #dddddd;
            font-weight: bold;
            padding: 0px 0px 0px 160px;
        }

        .box {
            border: 1px solid #1e77ad;
            box-shadow: 1px 1px 10px #989898;
            border-radius: 7px;
            background-color: #ccd8db;
            min-height: 300px;
            padding: 10px;
        }
    </style>

</head>
<body>

    <!-- tilte -->
    <div class="jumbotron p-4 p-md-5 text-white rounded color_title">
        <h1 class="display-2 font_title_style"><span style="color: #9e4f63">A</span>nomaly <span style="color: #3575a1">D</span>etector<span style="color: #9b854b">.</span></h1>
    </div>


    <div class="container-fluid" style="padding: 20px 200px 200px 200px;">

        <!-- width -->
        <header class="blog-header py-3">
        </header>

        <div class="row mb-2">
            <div class="col-md-7">
                <!-- graph -->
                <!--h1 class="font_title_graph_style">Graphs<span style="color: #3e99d7">.</span></!--h1>
                <!-- graph box-->
                <div class="box">
                    <h3>Please choose train file, test file and model</h3>
                    <form class="" action="detect" enctype="multipart/form-data" name="anomalyForm" method="post" target="anomalyDisplay">
                        <br>
                        <h3>Train file</h3>
                        <input required type="file" name="trainFile" value="">
                        <br>
                        <h3>Test file</h3>
                        <input required type="file" name="testFile" value="">
                        <br>
                        <h3>Model</h3>
                        <select required size="3" class="" name="anomlyModels">
                            <option value="regression">Regression</option>
                            <option value="hybrid">Hybrid</option>
                        </select>
                        <br>
                        <input type="submit">
                    </form>
                </div>

            </div>

            <div class="col-md-4 offset-1">
                <!-- models -->
                <!--h1 class="font_title_models_style">Models<span style="color: #47afb5">.</span></!--h1>
                <!-- models box-->
                <div class="box" id="ad"></div>
            </div>
        </div>

    </div>

    <!--iframe name="anomalyDisplay" width="80%" height="50%"></iframe-->
    <!--textarea id="ad" name="anomalyDisplay2" rows="8" cols="80"></textarea-->
    <script type="text/javascript">
            document.addEventListener("submit", (e) => {
                var response;
                const form = e.target;
                e.preventDefault();
                fetch(form.action, {
                    method: form.method,
                    body: new FormData(form),
                })
                    .then((res) => res.text())
                    .then((text) => new DOMParser().parseFromString(text, "text/html"))
                    .then((doc) => {
                        var result = document.getElementById('ad');
                        while (result.firstChild) {
                            result.removeChild(result.firstChild);
                        }
                        result.innerHTML = jsonToDisplay(doc.body.innerHTML);
                    })
                    .catch((err) => {
                        alret("Error")
                        console.error("Error");
                    });
            });



            function jsonToDisplay(data) {
                var s = "<div>";
                var jsonObj = JSON.parse(data);
                var obj = jsonObj["reports"];
                Object.keys(obj).forEach(function (key) {

                    var value = obj[key];

                    for (var i = 0; i < value.length; i++) {

                        s += "<p>\'" + key + "\'";
                        s += " with \'" + value[i]["withFeature"] + "\' in time ";
                        s += value[i]["start"] + " to " + value[i]["end"];
                        console.log(s);
                        s += "</p>";
                    }
                });
                s += "</div>"
                return s;
            }
    </script>

</body>
</html>